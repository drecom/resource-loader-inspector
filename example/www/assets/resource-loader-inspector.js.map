{"version":3,"sources":["webpack://resource-loader-inspector/webpack/universalModuleDefinition","webpack://resource-loader-inspector/webpack/bootstrap","webpack://resource-loader-inspector/./src/index.ts","webpack://resource-loader-inspector/./src/middleware/add_xhr_content_length.ts","webpack://resource-loader-inspector/./src/middleware/increment_resource_count.ts","webpack://resource-loader-inspector/./src/middleware/index.ts","webpack://resource-loader-inspector/./src/middleware/mark_loaded.ts","webpack://resource-loader-inspector/./src/middleware/request_resource_size.ts","webpack://resource-loader-inspector/./src/middleware/set_inspector_property.ts"],"names":[],"mappings":"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","file":"resource-loader-inspector.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"resource-loader-inspector\"] = factory();\n\telse\n\t\troot[\"resource-loader-inspector\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.ts\");\n","import Summary from 'interface/Summary';\nimport Loader from 'mock_interface/Loader';\n\nimport * as middlewares from './middleware';\n\nexport default class ResourceLoaderInspector {\n  /**\n   * attatches middlewares to loader instance.<br />\n   * this may cause lower performance.\n   */\n  public static observe(loader: Loader, headRequest: boolean = true): void {\n    loader.inspector = ResourceLoaderInspector.defaultInspectorProperty;\n\n    ResourceLoaderInspector.attachMiddlewares(loader, headRequest);\n  }\n\n  /**\n   * get snapshot of current resource statistics\n   */\n  public static snapshot(loader: Loader): Summary {\n    const summary = {\n      totalContentLength: 0,\n      resourceCount: 0,\n      contentLengthUnknown: 0\n    };\n\n    const resourceKeys = Object.keys(loader.resources);\n\n    summary.resourceCount = resourceKeys.length;\n\n    for (let i = 0; i < summary.resourceCount; i++) {\n      const resource = loader.resources[resourceKeys[i]];\n      if (!resource.inspector) {\n        summary.contentLengthUnknown++;\n      } else {\n        const contentLength = resource.inspector.contentLength;\n        if (contentLength !== undefined) {\n          summary.totalContentLength += contentLength;\n        } else {\n          summary.contentLengthUnknown++;\n        }\n      }\n    }\n\n    return summary;\n  }\n\n  /**\n   *\n   */\n  public static recollect(loader: Loader, headRequest: boolean = true): void {\n    const defaultInspector = ResourceLoaderInspector.defaultInspectorProperty;\n\n    if (!loader.inspector) {\n      loader.inspector = defaultInspector;\n    }\n\n    const summary = defaultInspector.summary;\n\n    const resourceKeys = Object.keys(loader.resources);\n\n    summary.resourceCount = resourceKeys.length;\n\n    for (let i = 0; i < summary.resourceCount; i++) {\n      const resource = loader.resources[resourceKeys[i]];\n\n      if (!resource.inspector) {\n        summary.contentLengthUnknown++;\n        continue;\n      }\n\n      const contentLength = resource.inspector.contentLength;\n      if (contentLength) {\n        summary.totalContentLength += contentLength;\n        continue;\n      }\n\n      if (headRequest) {\n        middlewares.requestResourceSize.call(loader, resource, () => {});\n        continue;\n      }\n\n      summary.contentLengthUnknown++;\n    }\n\n    loader.inspector.summary = summary;\n  }\n\n  private static get defaultInspectorProperty(): { summary: Summary, hasMiddleware: boolean } {\n    return {\n      summary: {\n        totalContentLength: 0,\n        resourceCount: 0,\n        contentLengthUnknown: 0\n      },\n      hasMiddleware: false\n    };\n  }\n\n  private static attachMiddlewares(loader: Loader, headRequest: boolean = true): void {\n    if (!loader.inspector) {\n      throw new Error('loader is not initialized');\n    }\n    if (loader.inspector.hasMiddleware) {\n      return;\n    }\n\n    loader.pre(middlewares.setInspectorProperty);\n    loader.pre(middlewares.markLoaded);\n\n    loader.use(middlewares.addXhrContentLength);\n    loader.use(middlewares.incrementResourceCount);\n\n    if (headRequest) {\n      loader.use(middlewares.requestResourceSize);\n    }\n\n    loader.inspector.hasMiddleware = true;\n  }\n}\n\nexport { Summary };\n","import LoaderMiddleware from 'mock_interface/LoaderMiddleware';\nimport Loader from 'mock_interface/Loader';\nimport Resource from 'mock_interface/Resource';\n\n/**\n * Retrieve content length from xhr and store the value\n * to resource and loader.inspectorSummary<br />\n * This middleware only works for loader that have valid xhr property.\n */\nconst addXhrContentLength = <LoaderMiddleware>function addXhrContentLength(\n  this:     Loader,\n  resource: Resource,\n  next:     Function\n): void {\n  if (!this.xhr) {\n    next();\n    return;\n  }\n\n  const contentLength = this.xhr.getResponseHeader('Content-Length');\n\n  if (!contentLength) {\n    next();\n    return;\n  }\n\n  const contentLengthInt = parseInt(contentLength, 10);\n\n  if (resource.inspector) {\n    if (resource.inspector.alreadyLoaded) {\n      next();\n      return;\n    }\n\n    resource.inspector.contentLength = contentLengthInt;\n  }\n\n  if (this.inspector) {\n    this.inspector.summary.totalContentLength += contentLengthInt;\n  }\n\n  next();\n};\n\nexport { addXhrContentLength };\n","import LoaderMiddleware from 'mock_interface/LoaderMiddleware';\nimport Loader from 'mock_interface/Loader';\nimport Resource from 'mock_interface/Resource';\n\n/**\n * Increments resource count.\n */\nconst incrementResourceCount = <LoaderMiddleware>function incrementResourceCount(\n  this:     Loader,\n  resource: Resource,\n  next:     Function\n): void {\n  if (resource.inspector && resource.inspector.alreadyLoaded) {\n    next();\n    return;\n  }\n\n  if (this.inspector) {\n    this.inspector.summary.resourceCount++;\n  }\n  next();\n};\n\nexport { incrementResourceCount };\n","export * from './set_inspector_property';\nexport * from './mark_loaded';\nexport * from './increment_resource_count';\nexport * from './add_xhr_content_length';\nexport * from './request_resource_size';\n","import LoaderMiddleware from 'mock_interface/LoaderMiddleware';\nimport Loader from 'mock_interface/Loader';\nimport Resource from 'mock_interface/Resource';\n\n/**\n *\n */\nconst markLoaded = <LoaderMiddleware>function markLoaded(\n  this:     Loader,\n  resource: Resource,\n  next:     Function\n): void {\n  if (resource.inspector) {\n    resource.inspector.alreadyLoaded = !!resource.data;\n  }\n  next();\n};\n\nexport { markLoaded };\n","import LoaderMiddleware from 'mock_interface/LoaderMiddleware';\nimport Loader from 'mock_interface/Loader';\nimport Resource from 'mock_interface/Resource';\n\nconst requestResourceSize = <LoaderMiddleware>function requestResourceSize(\n  this:     Loader,\n  resource: Resource,\n  next:     Function\n): void {\n  if (resource.inspector && resource.inspector.alreadyLoaded) {\n    next();\n    return;\n  }\n\n  if (this.xhr) {\n    return;\n  }\n\n  const xhr = new XMLHttpRequest();\n  xhr.open('HEAD', resource.url, true);\n  xhr.addEventListener(\n    'load',\n    () => {\n      const contentLength = xhr.getResponseHeader('Content-Length');\n\n      if (!contentLength) {\n        return;\n      }\n\n      const contentLengthInt = parseInt(contentLength, 10);\n\n      if (resource.inspector) {\n        resource.inspector.contentLength = contentLengthInt;\n      }\n\n      if (this.inspector) {\n        this.inspector.summary.totalContentLength += contentLengthInt;\n      }\n    },\n    false\n  );\n  xhr.send();\n\n  // no need to wait xhr procedure\n  next();\n};\n\nexport { requestResourceSize };\n","import LoaderMiddleware from 'mock_interface/LoaderMiddleware';\nimport Loader from 'mock_interface/Loader';\nimport Resource from 'mock_interface/Resource';\n\n/**\n *\n */\nconst setInspectorProperty = <LoaderMiddleware>function setInspectorProperty(\n  this:     Loader,\n  resource: Resource,\n  next:     Function\n): void {\n  resource.inspector = {\n    contentLength: 0,\n    alreadyLoaded: false\n  };\n  next();\n};\n\nexport { setInspectorProperty };\n"],"sourceRoot":""}